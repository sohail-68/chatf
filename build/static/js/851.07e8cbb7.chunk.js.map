{"version":3,"file":"static/js/851.07e8cbb7.chunk.js","mappings":";4KAGO,MAgBDA,GAAYC,EAAAA,EAAAA,GAAiB,aAhBC,CAClC,CAAC,OAAQ,CAAEC,EAAG,iBAAkBC,IAAK,WACrC,CAAC,OAAQ,CAAED,EAAG,WAAYC,IAAK,aCe3BC,GAAmBH,EAAAA,EAAAA,GAAiB,oBAjBN,CAClC,CAAC,SAAU,CAAEI,GAAI,KAAMC,GAAI,KAAMC,EAAG,IAAKJ,IAAK,WAC9C,CAAC,SAAU,CAAEE,GAAI,KAAMC,GAAI,IAAKC,EAAG,IAAKJ,IAAK,WAC7C,CAAC,SAAU,CAAEE,GAAI,KAAMC,GAAI,KAAMC,EAAG,IAAKJ,IAAK,aCmB1CK,GAAiBP,EAAAA,EAAAA,GAAiB,kBAtBJ,CAClC,CACE,OACA,CACEC,EAAG,oIACHC,IAAK,WAGT,CAAC,OAAQ,CAAED,EAAG,WAAYC,IAAK,4CCyXjC,MAsNA,EAtNa,KACX,MAAM,YAAEM,EAAW,SAAEC,EAAQ,UAAEC,IAAcC,EAAAA,EAAAA,KACvCC,EAAgBC,eAAeC,QAAQ,WACrCC,GAAIC,IAAgBC,EAAAA,EAAAA,MACtBC,GAAWC,EAAAA,EAAAA,OAEVC,EAASC,IAAcC,EAAAA,EAAAA,UAAS,KAChCC,EAAMC,IAAWF,EAAAA,EAAAA,UAAS,CAAC,IAC3BG,EAAOC,IAAYJ,EAAAA,EAAAA,WAAS,IAC5BK,EAAUC,IAAeN,EAAAA,EAAAA,WAAS,GACnCO,GAAWC,EAAAA,EAAAA,OAGjBC,EAAAA,EAAAA,YAAU,KACR,MAAMC,GAASC,EAAAA,EAAAA,KA6Bf,OA5BAD,EAAOE,UACPxB,EAAUsB,GAEVA,EAAOG,KAAK,WAAYvB,GAGxBoB,EAAOI,GAAG,kBAAmBC,KAExBA,EAAIC,SAAWtB,GAAeqB,EAAIE,WAAa3B,GAC/CyB,EAAIC,SAAW1B,GAAiByB,EAAIE,WAAavB,IAElDR,GAAagC,IACX,MAAMC,EAAkB,IAAID,EAAMH,GAElC,OADAK,aAAaC,QAAQ,eAAgBC,KAAKC,UAAUJ,IAC7CA,CAAe,GAE1B,IAIFT,EAAOI,GAAG,UAAWU,IACfA,IAAW9B,GAAaY,GAAY,EAAK,IAG/CI,EAAOI,GAAG,cAAeU,IACnBA,IAAW9B,GAAaY,GAAY,EAAM,IAGzC,KACLI,EAAOe,IAAI,kBACXf,EAAOe,IAAI,UACXf,EAAOe,IAAI,aAAa,CACzB,GACA,CAACnC,EAAeI,EAAaR,EAAaE,KAG7CqB,EAAAA,EAAAA,YAAU,KACciB,WACpB,IACE,MAAMC,QAAYC,EAAAA,EAAAA,IACf,gDAA+ClC,IAChD,CACEmC,QAAS,CACPC,cAAevC,eAAeC,QAAQ,YAI5CN,EAAYyC,EAAI1B,MAChBmB,aAAaC,QAAQ,eAAgBC,KAAKC,UAAUI,EAAI1B,MAG1D,CAFE,MAAO8B,GACPC,QAAQC,MAAM,gCAAiCF,EACjD,GAGFG,EAAe,GACd,CAAC5C,EAAeI,EAAaR,IAuDhC,OAJAuB,EAAAA,EAAAA,YAAU,KAZeiB,WACvB,IACE,MAAMC,QAAYC,EAAAA,EAAAA,IACf,oDAAmDlC,IACpD,CAAEmC,QAAS,CAAEC,cAAevC,eAAeC,QAAQ,YAErDU,EAAQyB,EAAI1B,KAGd,CAFE,MAAOgC,GACPD,QAAQC,MAAM,+BAAgCA,EAChD,GAIAE,EAAkB,GACjB,CAACzC,KAGF,iBAAK0C,UAAU,kDAAiD,WAE9D,iBAAKA,UAAU,6DAA4D,WACzE,mBACEC,QAAS,IAAM9B,GAAU,GACzB6B,UAAU,gDAA+C,UAEzD,SAAC3D,EAAS,CAAC2D,UAAU,6BAGvB,UAAC,KAAI,CACHE,GAAK,gBAAerC,EAAKsC,MACzBH,UAAU,iCAAgC,WAE1C,gBACEI,IAAKvC,EAAKwC,eACVC,IAAI,UACJN,UAAU,uCAEZ,iBAAKA,UAAU,WAAU,WACvB,eAAIA,UAAU,+CAA8C,SACzDnC,EAAK0C,WAEPtC,IACC,iBAAM+B,UAAU,6CAA4C,SAAC,qBAOnE,mBAAQA,UAAU,gDAA+C,UAC/D,SAAC,EAAY,CAACA,UAAU,gCAK5B,gBAAKA,UAAU,wDAAuD,UAClExC,EAASgD,OAASzD,GAAU0D,KAAI,CAAC9B,EAAK+B,KAAG,eACzC,gBAEEV,UAAY,SACVW,QAAiB,QAAV,EAAAhC,EAAIC,cAAM,aAAV,EAAYuB,MAAOxB,EAAIC,UAAY+B,OAAOzD,GAC7C,cACA,iBACH,UAEH,iBACE8C,UAAY,qDACVW,QAAiB,QAAV,EAAAhC,EAAIC,cAAM,aAAV,EAAYuB,MAAOxB,EAAIC,UAAY+B,OAAOzD,GAC7C,yCACA,6CACH,UAEFyB,EAAIiC,SACL,gBAAKZ,UAAU,4CAA2C,SACvD,IAAIa,KAAKlC,EAAImC,WAAWC,mBAAmB,GAAI,CAC9CC,KAAM,UACNC,OAAQ,kBAlBTP,EAsBD,OAKV,iBAAKV,UAAU,sEAAqE,WAClF,kBACEkB,KAAK,OACLC,MAAOzD,EACP0D,SApGcC,IACpB1D,EAAW0D,EAAEC,OAAOH,OACpB,MAAM7C,GAASC,EAAAA,EAAAA,KACX8C,EAAEC,OAAOH,MACX7C,EAAOG,KAAK,SAAUvB,IAEtBc,GAAS,GACTM,EAAOG,KAAK,aAAcvB,GAC5B,EA6FMqE,QAAS,IAAMvD,GAAS,GACxBwD,OAAQ,IAAMxD,GAAS,GACvByD,YAAY,aACZzB,UAAU,2IAEZ,mBACEC,QAnIY,KAClB,GAAIvC,EAAQgE,OAAQ,CAClB,MAAMC,EAAU,CACd/C,OAAQ1B,EACR2B,SAAUvB,EACVsD,QAASlD,EACToD,WAAW,IAAID,MAAOe,eAGlBtD,GAASC,EAAAA,EAAAA,KACfD,EAAOG,KAAK,cAAekD,GAE3B7E,GAAagC,IACX,MAAMC,EAAkB,IAAID,EAAM6C,GAElC,OADA3C,aAAaC,QAAQ,eAAgBC,KAAKC,UAAUJ,IAC7CA,CAAe,IAGxBpB,EAAW,IACXW,EAAOG,KAAK,aAAcvB,EAC5B,GAgHM8C,UAAU,yDAAwD,UAElE,SAAC,EAAa,CAACA,UAAU,mBAGzB","sources":["../node_modules/lucide-react/src/icons/arrow-left.ts","../node_modules/lucide-react/src/icons/ellipsis-vertical.ts","../node_modules/lucide-react/src/icons/send-horizontal.ts","components/Messges.jsx"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm12 19-7-7 7-7', key: '1l729n' }],\n  ['path', { d: 'M19 12H5', key: 'x3x0zl' }],\n];\n\n/**\n * @component @name ArrowLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTIgMTktNy03IDctNyIgLz4KICA8cGF0aCBkPSJNMTkgMTJINSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/arrow-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowLeft = createLucideIcon('arrow-left', __iconNode);\n\nexport default ArrowLeft;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['circle', { cx: '12', cy: '12', r: '1', key: '41hilf' }],\n  ['circle', { cx: '12', cy: '5', r: '1', key: 'gxeob9' }],\n  ['circle', { cx: '12', cy: '19', r: '1', key: 'lyex9k' }],\n];\n\n/**\n * @component @name EllipsisVertical\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxIiAvPgogIDxjaXJjbGUgY3g9IjEyIiBjeT0iNSIgcj0iMSIgLz4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjE5IiByPSIxIiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/ellipsis-vertical\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst EllipsisVertical = createLucideIcon('ellipsis-vertical', __iconNode);\n\nexport default EllipsisVertical;\n","import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  [\n    'path',\n    {\n      d: 'M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z',\n      key: '117uat',\n    },\n  ],\n  ['path', { d: 'M6 12h16', key: 's4cdu5' }],\n];\n\n/**\n * @component @name SendHorizontal\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMy43MTQgMy4wNDhhLjQ5OC40OTggMCAwIDAtLjY4My42MjdsMi44NDMgNy42MjdhMiAyIDAgMCAxIDAgMS4zOTZsLTIuODQyIDcuNjI3YS40OTguNDk4IDAgMCAwIC42ODIuNjI3bDE4LTguNWEuNS41IDAgMCAwIDAtLjkwNHoiIC8+CiAgPHBhdGggZD0iTTYgMTJoMTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/send-horizontal\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst SendHorizontal = createLucideIcon('send-horizontal', __iconNode);\n\nexport default SendHorizontal;\n","// import axios from 'axios';\r\n// import React, { useState, useEffect } from 'react';\r\n// import { Link, useLocation, useNavigate, useParams } from 'react-router-dom';\r\n// import { io } from 'socket.io-client';\r\n// import { FiMoreVertical, FiSend } from 'react-icons/fi';\r\n// import useChatMessages from '../hooks/useChatMessages';\r\n// import { ArrowLeft, MoreVertical, SendHorizonal } from 'lucide-react';\r\n// import socket from \"./socket\";\r\n\r\n// const formatDate = (dateString) => {\r\n//     const date = new Date(dateString);\r\n//     const now = new Date();\r\n//     const isToday = date.toDateString() === now.toDateString();\r\n//     const time = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true });\r\n//     return isToday ? time : `${date.toLocaleDateString()} ${time}`;\r\n// };\r\n\r\n\r\n// const Chat = () => {\r\n//   const { setMessages, messages, } = useChatMessages();\r\n//   const currentUserId = sessionStorage.getItem(\"userid\");\r\n//   const { id: recipientId } = useParams();\r\n//   const location = useLocation();\r\n\r\n//   const [message, setMessage] = useState(\"\");\r\n//   const [data, setData] = useState({});\r\n//   const [focus, setFocus] = useState(false);\r\n//   const [isTyping, setIsTyping] = useState(false);\r\n//   const navigate = useNavigate();\r\n\r\n//   const userId = sessionStorage.getItem(\"userid\");\r\n//   // ðŸ”Œ Socket setup\r\n//   useEffect(() => {\r\n//   if (userId) {\r\n//     socket.connect();\r\n//     socket.emit(\"joinRoom\", String(userId));\r\n//   }\r\n// }, []);\r\n//   useEffect(() => {\r\n\r\n//     socket.emit(\"joinRoom\", currentUserId);\r\n\r\n//     // incoming message listener\r\n//     socket.on(\"receiveMessage\", (msg) => {\r\n//       if (\r\n//         (msg.sender === recipientId && msg.receiver === currentUserId) ||\r\n//         (msg.sender === currentUserId && msg.receiver === recipientId)\r\n//       ) {\r\n//         setMessages((prev) => {\r\n//           const updatedMessages = [...prev, msg];\r\n//           localStorage.setItem(\"chatMessages\", JSON.stringify(updatedMessages));\r\n//           return updatedMessages;\r\n//         });\r\n//       }\r\n//     });\r\n\r\n//     // typing events\r\n//     socket.on(\"typing\", (userId) => {\r\n//       if (userId === recipientId) setIsTyping(true);\r\n//     });\r\n\r\n//     socket.on(\"stopTyping\", (userId) => {\r\n//       if (userId === recipientId) setIsTyping(false);\r\n//     });\r\n\r\n//     return () => socket.disconnect();\r\n//   }, [currentUserId, recipientId, setMessages, ]);\r\n\r\n//   // ðŸ“¥ Fetch messages from API\r\n//   useEffect(() => {\r\n//     const fetchMessages = async () => {\r\n//       try {\r\n//         const res = await axios.get(\r\n//           `https://chatb-vrft.onrender.com/api/messages/${recipientId}`,\r\n//           {\r\n//             headers: {\r\n//               Authorization: sessionStorage.getItem(\"token\"),\r\n//             },\r\n//           }\r\n//         );\r\n//         setMessages(res.data);\r\n//         localStorage.setItem(\"chatMessages\", JSON.stringify(res.data));\r\n//       } catch (err) {\r\n//         console.error(\"Error fetching chat messages:\", err);\r\n//       }\r\n//     };\r\n\r\n//     fetchMessages();\r\n//   }, [currentUserId, recipientId, setMessages]);\r\n\r\n//   // âœ‰ï¸ Send message\r\n//   const sendMessage = () => {\r\n//     if (message.trim()) {\r\n//       const msgData = {\r\n//         sender: currentUserId,\r\n//         receiver: recipientId,\r\n//         content: message,\r\n//        createdAt: new Date().toISOString(),\r\n\r\n//       };\r\n\r\n//       socket.emit(\"sendMessage\", msgData);\r\n\r\n//       setMessages((prev) => {\r\n//         const updatedMessages = [...prev, msgData];\r\n//         localStorage.setItem(\"chatMessages\", JSON.stringify(updatedMessages));\r\n//         return updatedMessages;\r\n//       });\r\n\r\n//       setMessage(\"\");\r\n//       socket.emit(\"stopTyping\", currentUserId);\r\n//     }\r\n//   };\r\n\r\n//   // âœï¸ Handle typing\r\n//   const handleTyping = (e) => {\r\n//     setMessage(e.target.value);\r\n//     if (e.target.value) {\r\n//       socket.emit(\"typing\", currentUserId);\r\n//     } else {\r\n//       setFocus(false);\r\n//       socket.emit(\"stopTyping\", currentUserId);\r\n//     }\r\n//   };\r\n\r\n//   console.log(messages);\r\n  \r\n//   // ðŸ‘¤ Fetch recipient profile\r\n//   const fetchUserProfile = async () => {\r\n//     try {\r\n//       const res = await axios.get(\r\n//         `https://chatb-vrft.onrender.com/api/auth/userpro/${recipientId}`,\r\n//         { headers: { Authorization: sessionStorage.getItem(\"token\") } }\r\n//       );\r\n//       setData(res.data);\r\n//     } catch (error) {\r\n//       console.error(\"Error fetching user profile:\", error);\r\n//     }\r\n//   };\r\n\r\n//   useEffect(() => {\r\n//     fetchUserProfile();\r\n//   }, [recipientId]);\r\n\r\n//   return (\r\n// <div className=\"flex flex-col justify-between h-screen bg-white\">\r\n//   {/* Header */}\r\n//   <div className=\"flex items-center gap-3 px-4 py-3 border-b border-gray-200\">\r\n//     <button\r\n//       onClick={() => navigate(-1)}\r\n//       className=\"p-2 hover:bg-gray-100 rounded-full transition\"\r\n//     >\r\n//       <ArrowLeft className=\"h-5 w-5 text-gray-800\" />\r\n//     </button>\r\n\r\n//     <Link to={`/userprofile/${data._id}`} className=\"flex items-center gap-3 flex-1\">\r\n//       <img\r\n//         src={data.profilePicture}\r\n//         alt=\"Profile\"\r\n//         className=\"w-9 h-9 rounded-full object-cover\"\r\n//       />\r\n//       <div className=\"truncate\">\r\n//         <h2 className=\"text-sm font-semibold text-gray-900 truncate\">{data.username}</h2>\r\n//         {isTyping && (\r\n//           <span className=\"text-xs text-gray-500 italic animate-pulse\">Typing...</span>\r\n//         )}\r\n//       </div>\r\n//     </Link>\r\n\r\n//     <button className=\"p-2 hover:bg-gray-100 rounded-full transition\">\r\n//       <MoreVertical className=\"h-5 w-5 text-gray-800\" />\r\n//     </button>\r\n//   </div>\r\n\r\n//   {/* Messages */}\r\n//   <div className=\"flex-1 overflow-y-auto px-4 py-3 space-y-2 bg-gray-50\">\r\n//     {(location.state || messages).map((msg, idx) => (\r\n//       <div\r\n//         key={idx}\r\n//        className={`flex ${\r\n//     String(msg.sender?._id || msg.sender) === String(currentUserId)\r\n//       ? \"justify-end\"\r\n//       : \"justify-start\"\r\n//   }`}\r\n//       >\r\n//         <div\r\n//           className={`px-4 py-2 rounded-2xl text-sm max-w-[75%] shadow ${\r\n//                String(msg.sender?._id || msg.sender) === String(currentUserId)\r\n\r\n//               ? \"bg-blue-500 text-white rounded-br-none\"\r\n//               : \"bg-gray-200 text-gray-800 rounded-bl-none\"\r\n//           }`}\r\n//         >\r\n//           {msg.content}\r\n//           <div className=\"text-[10px] text-gray-500 mt-1 text-right\">\r\n//                 {new Date(msg.createdAt).toLocaleTimeString([], {\r\n//                   hour: \"2-digit\",\r\n//                   minute: \"2-digit\",\r\n//                 })}\r\n//           </div>\r\n//         </div>\r\n//       </div>\r\n//     ))}\r\n//   </div>\r\n\r\n//   {/* Input Section */}\r\n//   <div className=\"border-t border-gray-200 bg-white px-3 py-2 flex items-center gap-2\">\r\n//     <input\r\n//       type=\"text\"\r\n//       value={message}\r\n//       onChange={handleTyping}\r\n//       onFocus={() => setFocus(true)}\r\n//       onBlur={() => setFocus(false)}\r\n//       placeholder=\"Message...\"\r\n//       className=\"flex-1 px-4 py-2 rounded-full bg-gray-100 text-gray-800 placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-400\"\r\n//     />\r\n//     <button\r\n//       onClick={sendMessage}\r\n//       className=\"p-2 text-blue-500 hover:scale-110 transition-transform\"\r\n//     >\r\n//       <SendHorizonal className=\"h-6 w-6\" />\r\n//     </button>\r\n//   </div>\r\n// </div>\r\n\r\n//   );\r\n// };\r\n\r\n// export default Chat;\r\n\r\n\r\n\r\n\r\n\r\n\r\n// import React, { useEffect, useState, useRef } from \"react\";\r\n// import { useParams } from \"react-router-dom\";\r\n// import io from \"socket.io-client\";\r\n// import axios from \"axios\";\r\n\r\n// export default function Chat() {\r\n//   const [messages, setMessages] = useState([]);\r\n//   const [newMsg, setNewMsg] = useState(\"\");\r\n//   const [userData, setUserData] = useState(null);\r\n//   const { id: receiverId } = useParams();\r\n//   const currentUserId = sessionStorage.getItem(\"userid\");\r\n//   const messagesEndRef = useRef(null);\r\n//   const socketRef = useRef(null); // ðŸ”‘ store socket instance\r\n\r\n//   useEffect(() => {\r\n//     if (!currentUserId) return;\r\n\r\n//     const socket = io(\"https://chatb-vrft.onrender.com\");\r\n//     socketRef.current = socket; // save in ref\r\n\r\n//     socket.emit(\"join\", currentUserId);\r\n\r\n//     // Fetch old messages\r\n//     axios\r\n//       .get(`https://chatb-vrft.onrender.com/api/messages/${receiverId}`, {\r\n//         headers: { Authorization: sessionStorage.getItem(\"token\") },\r\n//       })\r\n//       .then((res) => setMessages(res.data))\r\n//       .catch((err) => console.error(\"Fetch messages error:\", err));\r\n\r\n//     // Fetch user profile\r\n//     axios\r\n//       .get(`https://chatb-vrft.onrender.com/api/auth/userpro/${receiverId}`, {\r\n//         headers: { Authorization: sessionStorage.getItem(\"token\") },\r\n//       })\r\n//       .then((res) => setUserData(res.data))\r\n//       .catch((err) => console.error(\"Fetch user error:\", err));\r\n\r\n//     // Real-time receive\r\n//     socket.on(\"receiveMessage\", (msg) => {\r\n//     if (\r\n//   (msg.senderId === receiverId && msg.receiverId === currentUserId) ||\r\n//   (msg.senderId === currentUserId && msg.receiverId === receiverId)\r\n// ) {\r\n//   setMessages((prev) => [...prev, msg]);\r\n// }\r\n\r\n//     });\r\n\r\n\r\n//     // Clean-up\r\n//     return () => {\r\n//       socket.off(\"receiveMessage\");\r\n//       socket.disconnect(); // ðŸ”‘ disconnect properly\r\n//     };\r\n//   }, [currentUserId, receiverId]);\r\n\r\n//   console.log(messages);\r\n  \r\n//   useEffect(() => {\r\n//     messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n//   }, [messages]);\r\n\r\n//   const sendMessage = () => {\r\n//     if (!newMsg.trim() || !socketRef.current) return;\r\n\r\n//     const message = {\r\n//       senderId: currentUserId,\r\n//       receiverId,\r\n//       content: newMsg,\r\n//       createdAt: new Date().toISOString(),\r\n//     };\r\n\r\n//     socketRef.current.emit(\"sendMessage\", message); // âœ… use ref\r\n\r\n//     setMessages((prev) => [...prev, message]); // optimistic UI\r\n//     setNewMsg(\"\");\r\n//   };\r\n\r\n//   return (\r\n//     <div className=\"flex flex-col h-screen bg-gray-100\">\r\n//       {/* Chat Header */}\r\n//       <div className=\"flex items-center gap-3 bg-blue-600 text-white px-4 py-3 shadow-md\">\r\n//         {userData && (\r\n//           <img\r\n//             src={userData.profilePicture || \"https://via.placeholder.com/40\"}\r\n//             alt=\"profile\"\r\n//             className=\"w-10 h-10 rounded-full border-2 border-white object-cover\"\r\n//           />\r\n//         )}\r\n//         <div>\r\n//           <h2 className=\"font-semibold text-base\">\r\n//             {userData?.username || \"Chat\"}\r\n//           </h2>\r\n//           <p className=\"text-xs text-gray-200\">Online</p>\r\n//         </div>\r\n//       </div>\r\n\r\n//       {/* Messages Section */}\r\n//       <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\r\n//         {messages.map((m, i) => (\r\n//           <div\r\n//             key={i}\r\n//             className={`flex ${\r\n//               m.senderId === currentUserId ? \"justify-end\" : \"justify-start\"\r\n//             }`}\r\n//           >\r\n//             <div\r\n//               className={`max-w-xs px-4 py-2 rounded-2xl shadow text-sm ${\r\n//                 m.senderId === currentUserId\r\n//                   ? \"bg-blue-500 text-white rounded-br-none\"\r\n//                   : \"bg-white text-gray-800 border rounded-bl-none\"\r\n//               }`}\r\n//             >\r\n//               {m.content}\r\n//               <div className=\"text-[10px] text-gray-300 mt-1 text-right\">\r\n//                 {new Date(m.createdAt).toLocaleTimeString([], {\r\n//                   hour: \"2-digit\",\r\n//                   minute: \"2-digit\",\r\n//                 })}\r\n//               </div>\r\n//             </div>\r\n//           </div>\r\n//         ))}\r\n//         <div ref={messagesEndRef}></div>\r\n//       </div>\r\n\r\n//       {/* Input Section */}\r\n//       <div className=\"p-3 bg-white border-t flex items-center gap-2\">\r\n//         <input\r\n//           value={newMsg}\r\n//           onChange={(e) => setNewMsg(e.target.value)}\r\n//           placeholder=\"Type a message...\"\r\n//           className=\"flex-1 px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n//         />\r\n//         <button\r\n//           onClick={sendMessage}\r\n//           className=\"px-4 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition\"\r\n//         >\r\n//           Send\r\n//         </button>\r\n//       </div>\r\n//     </div>\r\n//   );\r\n// }\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { useParams, useNavigate, useLocation, Link } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { ArrowLeft, MoreVertical, SendHorizonal } from \"lucide-react\";\r\nimport useChatMessages from \"../hooks/useChatMessages\";\r\nimport { getSocket } from \"./socket\"; // âœ… import singleton socket\r\n\r\nconst Chat = () => {\r\n  const { setMessages, messages, setSocket } = useChatMessages();\r\n  const currentUserId = sessionStorage.getItem(\"userid\");\r\n  const { id: recipientId } = useParams();\r\n  const location = useLocation();\r\n\r\n  const [message, setMessage] = useState(\"\");\r\n  const [data, setData] = useState({});\r\n  const [focus, setFocus] = useState(false);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  // ðŸ”Œ Socket setup\r\n  useEffect(() => {\r\n    const socket = getSocket();\r\n    socket.connect(); // âœ… connect explicitly\r\n    setSocket(socket);\r\n\r\n    socket.emit(\"joinRoom\", currentUserId);\r\n\r\n    // incoming message listener\r\n    socket.on(\"receiveMessage\", (msg) => {\r\n      if (\r\n        (msg.sender === recipientId && msg.receiver === currentUserId) ||\r\n        (msg.sender === currentUserId && msg.receiver === recipientId)\r\n      ) {\r\n        setMessages((prev) => {\r\n          const updatedMessages = [...prev, msg];\r\n          localStorage.setItem(\"chatMessages\", JSON.stringify(updatedMessages));\r\n          return updatedMessages;\r\n        });\r\n      }\r\n    });\r\n\r\n    // typing events\r\n    socket.on(\"typing\", (userId) => {\r\n      if (userId === recipientId) setIsTyping(true);\r\n    });\r\n\r\n    socket.on(\"stopTyping\", (userId) => {\r\n      if (userId === recipientId) setIsTyping(false);\r\n    });\r\n\r\n    return () => {\r\n      socket.off(\"receiveMessage\");\r\n      socket.off(\"typing\");\r\n      socket.off(\"stopTyping\");\r\n    };\r\n  }, [currentUserId, recipientId, setMessages, setSocket]);\r\n\r\n  // ðŸ“¥ Fetch messages from API\r\n  useEffect(() => {\r\n    const fetchMessages = async () => {\r\n      try {\r\n        const res = await axios.get(\r\n          `https://chatb-vrft.onrender.com/api/messages/${recipientId}`,\r\n          {\r\n            headers: {\r\n              Authorization: sessionStorage.getItem(\"token\"),\r\n            },\r\n          }\r\n        );\r\n        setMessages(res.data);\r\n        localStorage.setItem(\"chatMessages\", JSON.stringify(res.data));\r\n      } catch (err) {\r\n        console.error(\"Error fetching chat messages:\", err);\r\n      }\r\n    };\r\n\r\n    fetchMessages();\r\n  }, [currentUserId, recipientId, setMessages]);\r\n\r\n  // âœ‰ï¸ Send message\r\n  const sendMessage = () => {\r\n    if (message.trim()) {\r\n      const msgData = {\r\n        sender: currentUserId,\r\n        receiver: recipientId,\r\n        content: message,\r\n        createdAt: new Date().toISOString(),\r\n      };\r\n\r\n      const socket = getSocket();\r\n      socket.emit(\"sendMessage\", msgData);\r\n\r\n      setMessages((prev) => {\r\n        const updatedMessages = [...prev, msgData];\r\n        localStorage.setItem(\"chatMessages\", JSON.stringify(updatedMessages));\r\n        return updatedMessages;\r\n      });\r\n\r\n      setMessage(\"\");\r\n      socket.emit(\"stopTyping\", currentUserId);\r\n    }\r\n  };\r\n\r\n  // âœï¸ Handle typing\r\n  const handleTyping = (e) => {\r\n    setMessage(e.target.value);\r\n    const socket = getSocket();\r\n    if (e.target.value) {\r\n      socket.emit(\"typing\", currentUserId);\r\n    } else {\r\n      setFocus(false);\r\n      socket.emit(\"stopTyping\", currentUserId);\r\n    }\r\n  };\r\n\r\n  // ðŸ‘¤ Fetch recipient profile\r\n  const fetchUserProfile = async () => {\r\n    try {\r\n      const res = await axios.get(\r\n        `https://chatb-vrft.onrender.com/api/auth/userpro/${recipientId}`,\r\n        { headers: { Authorization: sessionStorage.getItem(\"token\") } }\r\n      );\r\n      setData(res.data);\r\n    } catch (error) {\r\n      console.error(\"Error fetching user profile:\", error);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchUserProfile();\r\n  }, [recipientId]);\r\n\r\n  return (\r\n    <div className=\"flex flex-col justify-between h-screen bg-white\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center gap-3 px-4 py-3 border-b border-gray-200\">\r\n        <button\r\n          onClick={() => navigate(-1)}\r\n          className=\"p-2 hover:bg-gray-100 rounded-full transition\"\r\n        >\r\n          <ArrowLeft className=\"h-5 w-5 text-gray-800\" />\r\n        </button>\r\n\r\n        <Link\r\n          to={`/userprofile/${data._id}`}\r\n          className=\"flex items-center gap-3 flex-1\"\r\n        >\r\n          <img\r\n            src={data.profilePicture}\r\n            alt=\"Profile\"\r\n            className=\"w-9 h-9 rounded-full object-cover\"\r\n          />\r\n          <div className=\"truncate\">\r\n            <h2 className=\"text-sm font-semibold text-gray-900 truncate\">\r\n              {data.username}\r\n            </h2>\r\n            {isTyping && (\r\n              <span className=\"text-xs text-gray-500 italic animate-pulse\">\r\n                Typing...\r\n              </span>\r\n            )}\r\n          </div>\r\n        </Link>\r\n\r\n        <button className=\"p-2 hover:bg-gray-100 rounded-full transition\">\r\n          <MoreVertical className=\"h-5 w-5 text-gray-800\" />\r\n        </button>\r\n      </div>\r\n\r\n      {/* Messages */}\r\n      <div className=\"flex-1 overflow-y-auto px-4 py-3 space-y-2 bg-gray-50\">\r\n        {(location.state || messages).map((msg, idx) => (\r\n          <div\r\n            key={idx}\r\n            className={`flex ${\r\n              String(msg.sender?._id || msg.sender) === String(currentUserId)\r\n                ? \"justify-end\"\r\n                : \"justify-start\"\r\n            }`}\r\n          >\r\n            <div\r\n              className={`px-4 py-2 rounded-2xl text-sm max-w-[75%] shadow ${\r\n                String(msg.sender?._id || msg.sender) === String(currentUserId)\r\n                  ? \"bg-blue-500 text-white rounded-br-none\"\r\n                  : \"bg-gray-200 text-gray-800 rounded-bl-none\"\r\n              }`}\r\n            >\r\n              {msg.content}\r\n              <div className=\"text-[10px] text-gray-500 mt-1 text-right\">\r\n                {new Date(msg.createdAt).toLocaleTimeString([], {\r\n                  hour: \"2-digit\",\r\n                  minute: \"2-digit\",\r\n                })}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Input Section */}\r\n      <div className=\"border-t border-gray-200 bg-white px-3 py-2 flex items-center gap-2\">\r\n        <input\r\n          type=\"text\"\r\n          value={message}\r\n          onChange={handleTyping}\r\n          onFocus={() => setFocus(true)}\r\n          onBlur={() => setFocus(false)}\r\n          placeholder=\"Message...\"\r\n          className=\"flex-1 px-4 py-2 rounded-full bg-gray-100 text-gray-800 placeholder:text-gray-500 focus:outline-none focus:ring-1 focus:ring-gray-400\"\r\n        />\r\n        <button\r\n          onClick={sendMessage}\r\n          className=\"p-2 text-blue-500 hover:scale-110 transition-transform\"\r\n        >\r\n          <SendHorizonal className=\"h-6 w-6\" />\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Chat;\r\n"],"names":["ArrowLeft","createLucideIcon","d","key","EllipsisVertical","cx","cy","r","SendHorizontal","setMessages","messages","setSocket","useChatMessages","currentUserId","sessionStorage","getItem","id","recipientId","useParams","location","useLocation","message","setMessage","useState","data","setData","focus","setFocus","isTyping","setIsTyping","navigate","useNavigate","useEffect","socket","getSocket","connect","emit","on","msg","sender","receiver","prev","updatedMessages","localStorage","setItem","JSON","stringify","userId","off","async","res","axios","headers","Authorization","err","console","error","fetchMessages","fetchUserProfile","className","onClick","to","_id","src","profilePicture","alt","username","state","map","idx","String","content","Date","createdAt","toLocaleTimeString","hour","minute","type","value","onChange","e","target","onFocus","onBlur","placeholder","trim","msgData","toISOString"],"sourceRoot":""}